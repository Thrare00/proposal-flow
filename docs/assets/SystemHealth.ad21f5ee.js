import{j as e}from"./main.84a19ea1.js";import{r as i}from"./react-vendor.36470f4f.js";import{g as A,b as D}from"./api.4be7fc3e.js";import{B as U}from"./react-toastify.esm.4d70bec4.js";import{e as v,_ as F,R as u,r as H,g as S,p as j,f as T}from"./ui-lib.676c71c1.js";const I=({status:d,label:g})=>{const r={healthy:{icon:e.jsx(S,{className:"w-5 h-5 text-green-500"}),bg:"bg-green-50",text:"text-green-800"},warning:{icon:e.jsx(j,{className:"w-5 h-5 text-yellow-500"}),bg:"bg-yellow-50",text:"text-yellow-800"},error:{icon:e.jsx(T,{className:"w-5 h-5 text-red-500"}),bg:"bg-red-50",text:"text-red-800"},loading:{icon:e.jsx(u,{className:"w-5 h-5 text-blue-500 animate-spin"}),bg:"bg-blue-50",text:"text-blue-800"}},n=r[d]||r.loading;return e.jsxs("div",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium ${n.bg} ${n.text}`,children:[n.icon,e.jsx("span",{className:"ml-1.5",children:g})]})};function Z(){var b;const[d,g]=i.useState([]),[r,n]=i.useState(!0),[f,N]=i.useState(null),[y,k]=i.useState(null),[c,E]=i.useState(!0),[x,C]=i.useState(null),[t,L]=i.useState({total:0,success:0,error:0,lastSuccess:null,lastError:null}),$=s=>{var l,h;const a=s.filter(p=>p.ok),m=s.filter(p=>!p.ok);return{total:s.length,success:a.length,error:m.length,lastSuccess:((l=a[0])==null?void 0:l.timestamp)||null,lastError:((h=m[0])==null?void 0:h.timestamp)||null}},o=i.useCallback(async()=>{if(!r){n(!0),N(null);try{const[s,a]=await Promise.all([A(),D().catch(()=>({}))]),m=((s==null?void 0:s.events)||(s==null?void 0:s.results)||[]).map(l=>({...l,timestamp:l.timestamp||l.ts,id:l.id||l._id||"—",action:l.action||l.type||"Unknown",error:l.error||l.message||(l.ok?"":"Unknown error")})).sort((l,h)=>new Date(h.timestamp)-new Date(l.timestamp)).slice(0,50);g(m),L($(m)),(a!=null&&a.days||a!=null&&a.time)&&C(a),k(new Date)}catch(s){console.error("Failed to fetch health data:",s);const a=s.message||"Failed to load system health data";N(a),U.error(a)}finally{n(!1)}}},[r]);i.useEffect(()=>{o()},[]),i.useEffect(()=>{if(!c)return;const s=setInterval(o,3e4);return()=>clearInterval(s)},[c,o]);const w=(()=>{if(r)return"loading";if(f||t.error>0)return"error";if(t.lastSuccess&&t.lastError){const s=new Date(t.lastSuccess);return new Date(t.lastError)>s?"error":"healthy"}return t.total>0?"healthy":"warning"})(),R={healthy:"All Systems Operational",warning:"System Status Unknown",error:"Service Degradation",loading:"Checking System Status..."};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between mb-8",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"System Health Dashboard"}),e.jsxs("div",{className:"mt-1 flex flex-col sm:flex-row sm:flex-wrap sm:mt-0 sm:space-x-6",children:[e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[e.jsx(v,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),y?`Last updated ${y.toLocaleTimeString()}`:"Loading..."]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[e.jsx(F,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),x?`Runs ${(b=x.days)==null?void 0:b.join(", ")} at ${x.time} ${x.tz||""}`:"Loading schedule..."]})]})]}),e.jsxs("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:[e.jsxs("button",{type:"button",onClick:()=>E(!c),className:`inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium ${c?"bg-blue-600 text-white hover:bg-blue-700":"bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(u,{className:`-ml-1 mr-2 h-4 w-4 ${c?"animate-spin":""}`}),c?"Auto-refresh ON":"Auto-refresh OFF"]}),e.jsxs("button",{type:"button",onClick:o,disabled:r,className:"ml-3 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(u,{className:`-ml-1 mr-2 h-4 w-4 ${r?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-8",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsxs("div",{className:"md:flex md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg leading-6 font-medium text-gray-900",children:"System Status"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Current operational status of the system"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(I,{status:w,label:R[w]})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500 rounded-md p-3",children:e.jsx(H,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Events"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:t.total})})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-green-500 rounded-md p-3",children:e.jsx(S,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Successful"}),e.jsxs("dd",{className:"flex items-baseline",children:[e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:t.success}),t.total>0&&e.jsxs("div",{className:"ml-2 flex items-baseline text-sm font-semibold text-green-600",children:[Math.round(t.success/t.total*100),"%"]})]})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-red-500 rounded-md p-3",children:e.jsx(j,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Errors"}),e.jsxs("dd",{className:"flex items-baseline",children:[e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:t.error}),t.total>0&&e.jsxs("div",{className:"ml-2 flex items-baseline text-sm font-semibold text-red-600",children:[Math.round(t.error/t.total*100),"%"]})]})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 bg-yellow-500 rounded-md p-3",children:e.jsx(v,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Last Success"}),e.jsx("dd",{className:"text-sm text-gray-900",children:t.lastSuccess?new Date(t.lastSuccess).toLocaleString():"N/A"})]})})]})})})]})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-5 border-b border-gray-200 sm:px-6",children:e.jsxs("div",{className:"-ml-4 -mt-2 flex items-center justify-between flex-wrap sm:flex-nowrap",children:[e.jsxs("div",{className:"ml-4 mt-2",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Event Log"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Recent system events and their status"})]}),e.jsx("div",{className:"ml-4 mt-2 flex-shrink-0",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:r?"Loading...":`Showing ${d.length} events`})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-4 text-center text-sm text-gray-500",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(u,{className:"animate-spin h-5 w-5 text-blue-500 mr-2"}),"Loading events..."]})})}):f?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-4 text-center text-sm text-red-600",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(j,{className:"h-5 w-5 text-red-500 mr-2"}),f]})})}):d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No events found"})}):d.map((s,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.timestamp?new Date(s.timestamp).toLocaleString():"—"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.action}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.id})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.ok?e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Success"}):e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800",children:"Error"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.error||"—"})]},`${s.id}-${a}`))})]})})]})]})})}export{Z as default};
//# sourceMappingURL=SystemHealth.ad21f5ee.js.map
