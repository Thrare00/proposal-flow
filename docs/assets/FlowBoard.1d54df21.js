import{a as U,j as r}from"./main.77452f8c.js";import{u as M,r as n}from"./react-vendor.36470f4f.js";import{d as B}from"./statusUtils.42174679.js";import{v as z,h as w,e as D,J as y,d as I}from"./ui-lib.77b3a936.js";import{p as P,i as F}from"./parseISO.5396ee51.js";import{a as J,i as q}from"./isAfter.4756b690.js";import{f as H}from"./format.ad2c0b21.js";import"./isValid.f1396d2d.js";const k=[{id:"intake",name:"Intake",next:"outline",container:"bg-blue-50 dark:bg-blue-900/10 border-l-4 border-blue-400 dark:border-blue-500",header:"bg-blue-700 dark:bg-blue-800 text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-blue-600 hover:bg-blue-700 text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-800 dark:text-gray-100",status:"text-blue-700 dark:text-blue-400",actions:[{id:"log_pipeline",label:"Log to Pipeline",icon:D,variant:"primary"},{id:"upload_docs",label:"Upload Docs",icon:y,variant:"secondary"}]},{id:"outline",name:"Outline",next:"drafting",container:"bg-purple-50 dark:bg-purple-900/10 border-l-4 border-purple-400 dark:border-purple-500",header:"bg-purple-700 dark:bg-purple-800 text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-purple-600 hover:bg-purple-700 text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-800 dark:text-gray-100",status:"text-purple-700 dark:text-purple-400",actions:[{id:"create_outline",label:"Create Outline",icon:w,variant:"primary"},{id:"upload_docs",label:"Upload Docs",icon:y,variant:"secondary"}]},{id:"drafting",name:"Drafting",next:"internal_review",container:"bg-amber-50 dark:bg-amber-900/10 border-l-4 border-amber-400 dark:border-amber-500",header:"bg-amber-600 dark:bg-amber-700 text-gray-900 dark:text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-amber-600 hover:bg-amber-700 text-gray-900 dark:text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-800 dark:text-gray-100",status:"text-amber-700 dark:text-amber-400",actions:[{id:"start_draft",label:"Start Draft",icon:w,variant:"primary"},{id:"upload_draft",label:"Upload Draft",icon:y,variant:"secondary"}]},{id:"internal_review",name:"Internal Review",next:"final_review",container:"bg-orange-50 dark:bg-orange-900/10 border-l-4 border-orange-400 dark:border-orange-500",header:"bg-orange-600 dark:bg-orange-700 text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-orange-600 hover:bg-orange-700 text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-800 dark:text-gray-100",status:"text-orange-700 dark:text-orange-400",actions:[{id:"request_review",label:"Request Review",icon:I,variant:"primary"},{id:"upload_feedback",label:"Upload Feedback",icon:y,variant:"secondary"}]},{id:"final_review",name:"Final Review",next:"submitted",container:"bg-emerald-50 dark:bg-emerald-900/10 border-l-4 border-emerald-400 dark:border-emerald-500",header:"bg-emerald-700 dark:bg-emerald-800 text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-emerald-600 hover:bg-emerald-700 text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-800 dark:text-gray-100",status:"text-emerald-700 dark:text-emerald-400",actions:[{id:"finalize",label:"Finalize",icon:D,variant:"primary"},{id:"upload_final",label:"Upload Final",icon:y,variant:"secondary"}]},{id:"submitted",name:"Submitted",next:null,container:"bg-gray-50 dark:bg-gray-800/30 border-l-4 border-gray-400 dark:border-gray-600",header:"bg-gray-600 dark:bg-gray-700 text-white",content:"bg-white/80 dark:bg-gray-800/80",primaryAction:"bg-gray-600 hover:bg-gray-700 text-white",secondaryAction:"bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",text:"text-gray-700 dark:text-gray-200",status:"text-gray-600 dark:text-gray-400",actions:[]}];function ee(){const v=M(),{proposals:m=[],fetchProposals:l}=U(),[c,R]=n.useState(""),[h,L]=n.useState(""),[u,p]=n.useState(!1),[j,g]=n.useState(null),[b,N]=n.useState({});n.useEffect(()=>{l&&(async()=>{try{p(!0),await l(),g(null)}catch(t){console.error("Error fetching proposals:",t),g("Failed to load proposals. Please try again.")}finally{p(!1)}})()},[l]);const E=n.useMemo(()=>{const e=new Set(m.map(t=>t.agency).filter(Boolean));return Array.from(e).sort()},[m]),C=n.useMemo(()=>{let e=[...m];if(c.trim()){const t=c.toLowerCase();e=e.filter(d=>(d.title||"").toLowerCase().includes(t)||(d.agency||"").toLowerCase().includes(t))}return h&&(e=e.filter(t=>t.agency===h)),e},[m,c,h]),$=n.useCallback(e=>{if(!e)return!1;const t=typeof e=="string"?P(e):e,d=new Date,a=J(d,7);return q(t,d)&&F(t,a)},[]),A=n.useCallback(e=>{if(!e)return!1;const t=typeof e=="string"?P(e):e;return F(t,new Date)},[]),O=n.useMemo(()=>{const e={};return k.forEach(t=>{e[t.id]=C.filter(d=>d.status===t.id).map(d=>({...d,isDueSoon:$(d.dueDate),isOverdue:A(d.dueDate),urgency:B(d.dueDate)}))}),e},[C,$,A]),_=n.useCallback(async(e,t,d)=>{const a=`${e}-${t}`;try{N(o=>({...o,[a]:!0})),g(null);const s=k.find(o=>o.id===d);switch(e){case"start_draft":case"create_outline":case"request_review":case"finalize":s!=null&&s.next&&await fetch(`/api/proposals/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s.next})});break;case"log_pipeline":await fetch(`/api/proposals/${t}/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"log_pipeline"})});break;case"upload_docs":case"upload_draft":case"upload_feedback":case"upload_final":const o=document.createElement("input");o.type="file",o.onchange=async f=>{const i=f.target.files[0];if(!i)return;const x=new FormData;x.append("file",i),x.append("action",e),await fetch(`/api/proposals/${t}/upload`,{method:"POST",body:x}),await l()},o.click();break;case"next_stage":default:s!=null&&s.next&&await fetch(`/api/proposals/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s.next})});break}await l()}catch(s){console.error(`Error in ${e}:`,s),g(`Failed to ${e.replace("_"," ")}. Please try again.`)}finally{N(s=>({...s,[a]:!1}))}},[l]),T=n.useCallback(e=>{v(`/proposals/${e}`)},[v]),S=n.useCallback(async()=>{if(l)try{p(!0),await l(),g(null)}catch(e){console.error("Error refreshing proposals:",e),g("Failed to refresh proposals. Please try again.")}finally{p(!1)}},[l]);return j?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:r.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg overflow-hidden",children:[r.jsx("div",{className:"bg-red-50 px-6 py-4 border-b border-red-100",children:r.jsx("h2",{className:"text-lg font-medium text-red-800",children:"Error Loading Proposals"})}),r.jsxs("div",{className:"p-6",children:[r.jsx("p",{className:"text-gray-700 mb-4",children:j}),r.jsx("button",{onClick:S,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:u,children:u?"Retrying...":"Retry"})]})]})}):r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Proposal Flow Board"}),r.jsx("button",{onClick:S,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:u,children:u?"Refreshing...":"Refresh"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),r.jsx("input",{type:"text",value:c,onChange:e=>R(e.target.value),className:"w-full p-2 border rounded",placeholder:"Search proposals..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Filter by Agency"}),r.jsxs("select",{value:h,onChange:e=>L(e.target.value),className:"w-full p-2 border rounded",children:[r.jsx("option",{value:"",children:"All Agencies"}),E.map(e=>r.jsx("option",{value:e,children:e},e))]})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 overflow-x-auto pb-4",children:k.map(e=>{const d=(O[e.id]||[]).filter(a=>!c||a.title&&a.title.toLowerCase().includes(c.toLowerCase())||a.agency&&a.agency.toLowerCase().includes(c.toLowerCase()));return r.jsxs("div",{className:`rounded-lg overflow-hidden min-w-[300px] ${e.container} shadow-md hover:shadow-lg transition-all duration-200`,children:[r.jsxs("div",{className:`flex justify-between items-center px-4 py-3 ${e.header} ${e.text}`,children:[r.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wider",children:e.name}),r.jsx("span",{className:"text-xs font-bold px-2.5 py-1 rounded-full bg-black/10 dark:bg-white/20",children:d.length})]}),r.jsxs("div",{className:"space-y-3",children:[d.map(a=>{var f;const s=`next-${a.id}`;b[s];const o=a.dueDate?new Date(a.dueDate):null;return r.jsxs("div",{className:`rounded-lg shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden ${e.content} ${a.urgency==="high"?"ring-1 ring-amber-500/30":""}`,children:[r.jsxs("div",{className:"p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:()=>T(a.id),children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("h4",{className:`font-medium line-clamp-2 text-sm leading-snug ${e.text}`,children:a.title||"Untitled"}),a.urgency==="high"&&r.jsx("span",{className:"ml-2 flex-shrink-0 inline-flex items-center px-2 py-0.5 rounded text-[10px] font-semibold bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-200",children:"Urgent"})]}),a.agency&&r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 truncate",children:a.agency}),o&&r.jsxs("div",{className:`mt-2 flex items-center text-xs font-medium ${a.isOverdue?"text-red-600 dark:text-red-400":a.isDueSoon?"text-amber-600 dark:text-amber-400":"text-gray-500 dark:text-gray-400"}`,children:[r.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1.5 ${a.isOverdue?"bg-red-500":a.isDueSoon?"bg-amber-400":"bg-gray-400"}`}),a.isOverdue?"Overdue: ":"Due: ",H(o,"MMM d, yyyy")]})]}),r.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700/50 p-2 bg-gray-50/50 dark:bg-gray-800/50",children:r.jsxs("div",{className:"flex justify-between items-center space-x-2",children:[r.jsx("div",{className:"flex-1 flex space-x-1 overflow-x-auto pb-1",children:e.actions.map(i=>r.jsxs("button",{onClick:x=>{x.stopPropagation(),_(i.id,a.id,e.id)},disabled:b[`${i.id}-${a.id}`],className:`flex items-center px-2 py-1 text-xs rounded-md transition-colors whitespace-nowrap ${i.variant==="primary"?e.primaryAction:e.secondaryAction} ${b[`${i.id}-${a.id}`]?"opacity-70 cursor-not-allowed":""}`,children:[r.jsx(i.icon,{className:"w-3 h-3 mr-1"}),i.label]},i.id))}),e.next&&r.jsx("button",{onClick:i=>{i.stopPropagation(),_("next_stage",a.id,e.id)},disabled:b[`next-${a.id}`],className:`p-1.5 rounded-full border transition-colors ${b[`next-${a.id}`]?"bg-gray-100 dark:bg-gray-700 text-gray-400 border-gray-200 dark:border-gray-600":"bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 hover:border-emerald-300 dark:hover:border-emerald-700"}`,title:`Move to ${((f=k.find(i=>i.id===e.next))==null?void 0:f.name)||"next stage"}`,children:b[`next-${a.id}`]?r.jsxs("svg",{className:"animate-spin h-3.5 w-3.5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):r.jsx(z,{className:"h-3.5 w-3.5"})})]})})]},a.id)}),d.length===0&&r.jsx("div",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500 bg-white/30 dark:bg-gray-800/30 rounded-lg border border-dashed border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"flex flex-col items-center justify-center p-2",children:[r.jsx(w,{className:"w-5 h-5 text-gray-300 dark:text-gray-600 mb-1"}),r.jsxs("p",{className:"text-xs",children:["No ",e.name.toLowerCase()," items"]}),r.jsx("p",{className:"text-2xs text-gray-400 dark:text-gray-500 mt-1",children:e.id==="intake"?"Add a new proposal to get started":"Drag items here or use actions"})]})})]})]},e.id)})})]})}export{ee as default};
//# sourceMappingURL=FlowBoard.1d54df21.js.map
