{"version":3,"file":"api.99838237.js","sources":["../../src/lib/api.js"],"sourcesContent":["// Prefer Cloudflare Worker proxy if configured\nconst GAS_PROXY = import.meta.env.VITE_GAS_PROXY;\nconst GAS = GAS_PROXY || import.meta.env.VITE_GAS_URL;\nconst HEALTH = import.meta.env.VITE_HEALTH_URL || GAS_PROXY || import.meta.env.VITE_GAS_URL;\nconst FOLDER = import.meta.env.VITE_REPORTS_FOLDER_ID;\n\n// One-time runtime logging to verify endpoints in the deployed bundle\nif (typeof window !== 'undefined' && !window.__PF_ENDPOINTS_LOGGED__) {\n  window.__PF_ENDPOINTS_LOGGED__ = true;\n  // eslint-disable-next-line no-console\n  console.log('[PF] Endpoints:', {\n    GAS_PROXY: import.meta.env.VITE_GAS_PROXY || null,\n    GAS_RESOLVED: GAS,\n    HEALTH_RESOLVED: HEALTH,\n    QUEUE_URL: (typeof import.meta !== 'undefined' && import.meta.env && (import.meta.env.VITE_QUEUE_URL || null)),\n  });\n}\n\nasync function j(url, opt) { \n  const r = await fetch(url, {\n    ...opt,\n    credentials: 'omit',\n    headers: {\n      'Accept': 'application/json',\n      ...(opt?.headers || {})\n    }\n  }); \n  \n  if (!r.ok) {\n    const text = await r.text().catch(() => '');\n    if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {\n      throw new Error('Server returned HTML instead of JSON. Check if the endpoint URL is correct.');\n    }\n    throw new Error(`${r.status} ${r.statusText} â€” ${text.slice(0, 200)}`);\n  }\n  \n  try {\n    return await r.json();\n  } catch (e) {\n    throw new Error('Failed to parse JSON response');\n  }\n}\n\nexport async function withRetry(fn, tries = 3, delay = 600) {\n  let last;\n  for (let i = 0; i < tries; i++) { \n    try { \n      return await fn(); \n    } catch (e) { \n      last = e; \n      if (i < tries - 1) {\n        await new Promise(r => setTimeout(r, delay * (i + 1)));\n      }\n    }\n  }\n  throw last;\n}\n\nexport async function getHealth() { \n  if (!HEALTH) throw new Error('Missing VITE_HEALTH_URL/VITE_GAS_URL');\n  return withRetry(() => j(`${HEALTH}?fn=getHealth`));\n}\n\nexport async function getCadence() { \n  if (!GAS) throw new Error('Missing VITE_GAS_URL');\n  return withRetry(() => j(`${GAS}?fn=getCadence`));\n}\n\nexport async function setCadence(payload) {\n  if (!GAS) throw new Error('Missing VITE_GAS_URL');\n  return withRetry(() => j(\n    `${GAS}?fn=setCadence`, \n    { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' }, \n      body: JSON.stringify(payload) \n    }\n  ));\n}\n\nexport async function getReports() { \n  if (!GAS || !FOLDER) throw new Error('Missing VITE_GAS_URL or VITE_REPORTS_FOLDER_ID');\n  return withRetry(() => j(`${GAS}?fn=getReports&folderId=${encodeURIComponent(FOLDER)}`));\n}\n\n// Backward compatibility\nexport async function gasGet(fn) {\n  return withRetry(() => j(`${GAS}?fn=${encodeURIComponent(fn)}`));\n}\n"],"names":["GAS_PROXY","GAS","HEALTH","FOLDER","j","url","opt","r","text","withRetry","fn","tries","delay","last","i","e","getHealth","getCadence","setCadence","payload","getReports"],"mappings":"AACA,MAAMA,EAAY,yDACZC,EAAMD,EACNE,EAAS,0DACTC,EAAS,oCAGX,OAAO,OAAW,KAAe,CAAC,OAAO,0BAC3C,OAAO,wBAA0B,GAEjC,QAAQ,IAAI,kBAAmB,CAC7B,UAAW,yDACX,aAAcF,EACd,gBAAiBC,EACjB,UAAY,OAAO,YAAgB,KAAe,CAAe,cAAA,kBAAA,eAAA,0DAAA,aAAA,kHAAA,gBAAA,0DAAA,eAAA,yDAAA,uBAAA,oCAAA,SAAA,kBAAA,KAAA,aAAA,IAAA,GAAA,KAAA,GAAA,IAAA,EAAA,GAAK,yDAC1E,CAAG,GAGH,eAAeE,EAAEC,EAAKC,EAAK,CACzB,MAAMC,EAAI,MAAM,MAAMF,EAAK,CACzB,GAAGC,EACH,YAAa,OACb,QAAS,CACP,OAAU,mBACV,IAAIA,GAAA,YAAAA,EAAK,UAAW,EACrB,CACL,CAAG,EAED,GAAI,CAACC,EAAE,GAAI,CACT,MAAMC,EAAO,MAAMD,EAAE,KAAM,EAAC,MAAM,IAAM,EAAE,EAC1C,MAAIC,EAAK,OAAO,WAAW,WAAW,GAAKA,EAAK,KAAM,EAAC,WAAW,OAAO,EACjE,IAAI,MAAM,6EAA6E,EAEzF,IAAI,MAAM,GAAGD,EAAE,MAAM,IAAIA,EAAE,UAAU,MAAMC,EAAK,MAAM,EAAG,GAAG,CAAC,EAAE,CACtE,CAED,GAAI,CACF,OAAO,MAAMD,EAAE,MAChB,MAAW,CACV,MAAM,IAAI,MAAM,+BAA+B,CAChD,CACH,CAEO,eAAeE,EAAUC,EAAIC,EAAQ,EAAGC,EAAQ,IAAK,CAC1D,IAAIC,EACJ,QAASC,EAAI,EAAGA,EAAIH,EAAOG,IACzB,GAAI,CACF,OAAO,MAAMJ,EAAE,CAChB,OAAQK,EAAG,CACVF,EAAOE,EACHD,EAAIH,EAAQ,GACd,MAAM,IAAI,QAAQJ,GAAK,WAAWA,EAAGK,GAASE,EAAI,EAAE,CAAC,CAExD,CAEH,MAAMD,CACR,CAEO,eAAeG,GAAY,CAEhC,OAAOP,EAAU,IAAML,EAAE,GAAGF,CAAM,eAAe,CAAC,CACpD,CAEO,eAAee,GAAa,CAEjC,OAAOR,EAAU,IAAML,EAAE,GAAGH,CAAG,gBAAgB,CAAC,CAClD,CAEO,eAAeiB,EAAWC,EAAS,CAExC,OAAOV,EAAU,IAAML,EACrB,GAAGH,CAAG,iBACN,CACE,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAoB,EAC/C,KAAM,KAAK,UAAUkB,CAAO,CAC7B,CACL,CAAG,CACH,CAEO,eAAeC,GAAa,CAEjC,OAAOX,EAAU,IAAML,EAAE,GAAGH,CAAG,2BAA2B,mBAAmBE,CAAM,CAAC,EAAE,CAAC,CACzF"}