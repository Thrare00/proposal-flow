{"version":3,"file":"FlowBoardTabs.59117894.js","sources":["../../src/pages/FlowBoardTabs.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport SOWAnalyzer from './SOWAnalyzer.jsx';\nimport { getOpportunities } from '../lib/api.js';\nimport { enqueue } from '../lib/enqueue.js';\n\nconst weights = {\n  Profitability: 80,\n  StrategicFit: 80,\n  Competition: 70,\n  SubcontractingPotential: 40,\n  LikelihoodOfAward: 55,\n  RelationshipLeverage: 45,\n  PastPerformanceMatch: 20,\n};\n\nfunction scoreOpp(opp) {\n  // Expect metrics as 0-100; if missing, treat as 0\n  const keys = Object.keys(weights);\n  const totalW = keys.reduce((s, k) => s + weights[k], 0);\n  const s = keys.reduce((sum, k) => sum + (Number(opp?.metrics?.[k]) || 0) * weights[k], 0);\n  return Math.round((s / totalW) * 100) / 100; // 2 decimals\n}\n\nfunction OpportunitiesTab() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [filter, setFilter] = useState('all');\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const data = await getOpportunities();\n        if (Array.isArray(data)) {\n          if (mounted) setItems(data);\n        } else if (Array.isArray(data?.opportunities)) {\n          if (mounted) setItems(data.opportunities);\n        } else {\n          if (mounted) setItems([]);\n        }\n      } catch (e) {\n        setError(e.message || 'Failed to load opportunities');\n        setItems([]);\n      } finally {\n        setLoading(false);\n      }\n    })();\n    return () => { mounted = false; };\n  }, []);\n\n  const ranked = useMemo(() => {\n    const enriched = items.map(o => ({ ...o, __score: scoreOpp(o) }));\n    return enriched.sort((a, b) => b.__score - a.__score);\n  }, [items]);\n\n  const upgradeStage = async (opp, nextStage) => {\n    await enqueue({ action: 'update_stage', payload: { opportunityId: opp.id, stage: nextStage } });\n  };\n\n  const logToPipeline = async (opp) => {\n    await enqueue({ action: 'log_pipeline_opportunity', payload: { opportunityId: opp.id } });\n  };\n\n  const createUpload = async (opp) => {\n    await enqueue({ action: 'create_upload_drop', payload: { opportunityId: opp.id } });\n  };\n\n  const runScan = async () => {\n    await enqueue({ action: 'run_opportunity_scan' });\n  };\n\n  if (loading) return <div className=\"p-4\">Loading opportunities...</div>;\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-semibold\">Opportunities</h2>\n        <button onClick={runScan} className=\"btn btn-primary\">Run Opportunity Scan</button>\n      </div>\n      {error && <div className=\"bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm\">{error}</div>}\n      <div className=\"overflow-x-auto\">\n        <table className=\"min-w-full text-sm\">\n          <thead>\n            <tr className=\"text-left border-b\">\n              <th className=\"p-2\">Rank</th>\n              <th className=\"p-2\">Title</th>\n              <th className=\"p-2\">Agency</th>\n              <th className=\"p-2\">Score</th>\n              <th className=\"p-2\">Stage</th>\n              <th className=\"p-2\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {ranked.map((o, idx) => (\n              <tr key={o.id || idx} className=\"border-b hover:bg-gray-50\">\n                <td className=\"p-2\">{idx + 1}</td>\n                <td className=\"p-2\"><a href={o.url} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 hover:underline\">{o.title || o.name || 'Untitled'}</a></td>\n                <td className=\"p-2\">{o.agency || '-'}</td>\n                <td className=\"p-2 font-medium\">{o.__score}</td>\n                <td className=\"p-2\">{o.stage || 'opportunity'}</td>\n                <td className=\"p-2 space-x-2\">\n                  <button onClick={() => logToPipeline(o)} className=\"btn btn-outline\">Log to Pipeline</button>\n                  <button onClick={() => createUpload(o)} className=\"btn btn-outline\">Upload Docs</button>\n                  <button onClick={() => upgradeStage(o, 'market_research')} className=\"btn btn-secondary\">Upgrade â†’ Research</button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n\nfunction MarketResearchTab() {\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-xl font-semibold\">Market Research</h2>\n      <SOWAnalyzer />\n    </div>\n  );\n}\n\nexport default function FlowBoardTabs() {\n  const [tab, setTab] = useState('opps');\n  return (\n    <div className=\"container mx-auto px-4 py-6 max-w-7xl\">\n      <h1 className=\"text-2xl font-bold mb-4\">Flow Board</h1>\n      <div className=\"border-b mb-4\">\n        <nav className=\"-mb-px flex space-x-6\" aria-label=\"Tabs\">\n          <button className={`py-2 border-b-2 ${tab==='opps'?'border-blue-600 text-blue-600':'border-transparent text-gray-500'}`} onClick={()=>setTab('opps')}>Opportunities</button>\n          <button className={`py-2 border-b-2 ${tab==='research'?'border-blue-600 text-blue-600':'border-transparent text-gray-500'}`} onClick={()=>setTab('research')}>Market Research</button>\n        </nav>\n      </div>\n      {tab==='opps' && <OpportunitiesTab />}\n      {tab==='research' && <MarketResearchTab />}\n    </div>\n  );\n}\n"],"names":["weights","scoreOpp","opp","keys","totalW","s","k","sum","_a","OpportunitiesTab","items","setItems","useState","loading","setLoading","error","setError","useEffect","mounted","data","getOpportunities","e","ranked","useMemo","o","a","b","upgradeStage","nextStage","enqueue","logToPipeline","createUpload","runScan","jsx","jsxs","idx","MarketResearchTab","SOWAnalyzer","FlowBoardTabs","tab","setTab"],"mappings":"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"}