import{a as O,j as e}from"./main.b5b31452.js";import{e as z,u as q,r as n,L}from"./react-vendor.36470f4f.js";import{u as R,T as J,X as B,t as K,f as S}from"./ui-lib.676c71c1.js";const C=({isOpen:l,onConfirm:d,onCancel:x,title:p,message:g,confirmText:y="Confirm",cancelText:t="Cancel",variant:o="default"})=>{const s=n.useRef(null),m=n.useRef(null);if(n.useEffect(()=>{const c=i=>{i.key==="Escape"&&x(),i.key==="Enter"&&i.ctrlKey&&d()};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[d,x]),n.useEffect(()=>{l&&m.current&&m.current.focus()},[l]),!l)return null;const r={default:"bg-blue-600 hover:bg-blue-700",danger:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",children:e.jsxs("div",{ref:s,className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",onKeyDown:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full ${o==="danger"?"bg-red-100":"bg-blue-100"}`,children:e.jsx(S,{className:`h-6 w-6 ${o==="danger"?"text-red-600":"text-blue-600"}`,"aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{id:"dialog-title",className:"text-lg font-medium text-gray-900",children:p}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:g})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense",children:[e.jsx("button",{type:"button",ref:m,onClick:d,className:`w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 text-base font-medium text-white ${r[o]||r.default} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm`,children:y}),e.jsx("button",{type:"button",onClick:x,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:col-start-1 sm:text-sm",children:t})]})]})})},_=()=>{const{id:l}=z(),d=q(),{getProposal:x,addProposal:p,updateProposal:g,deleteProposal:y}=O(),t=l?x(l):void 0,o=!!t,[s,m]=n.useState({title:(t==null?void 0:t.title)||"",agency:(t==null?void 0:t.agency)||"",dueDate:t!=null&&t.dueDate?new Date(t.dueDate).toISOString().slice(0,10):"",status:(t==null?void 0:t.status)||"intake",notes:(t==null?void 0:t.notes)||"",type:(t==null?void 0:t.type)||"federal"}),[r,c]=n.useState({}),[i,v]=n.useState(!1),[F,b]=n.useState(!1),[E,w]=n.useState(!1),[h,N]=n.useState(!1),j=n.useRef(JSON.stringify(s));n.useEffect(()=>{const a=JSON.stringify(s);N(j.current!==a)},[s]);const u=a=>{const{name:f,value:T}=a.target;m(I=>({...I,[f]:T}))},$=()=>{const a={};return s.title.trim()||(a.title="Title is required"),s.agency.trim()||(a.agency="Agency is required"),s.dueDate?new Date(s.dueDate)<new Date&&(a.dueDate="Due date cannot be in the past"):a.dueDate="Due date is required",c(a),Object.keys(a).length===0},D=a=>{if(a.preventDefault(),!!$()){if(!h){k();return}b(!0)}},k=async()=>{v(!0);try{const a={title:s.title.trim(),agency:s.agency.trim(),dueDate:new Date(`${s.dueDate}T12:00:00`).toISOString(),status:s.status,type:s.type,notes:s.notes.trim()};let f;o&&l?(await g(l,a),f=l):f=await p(a),j.current=JSON.stringify({...s,id:f}),d(`/proposals/${f}`,{state:{message:o?"Proposal updated successfully!":"Proposal created successfully!",variant:"success"}})}catch(a){console.error("Error saving proposal:",a),c({form:"Failed to save proposal. Please try again."})}finally{v(!1),b(!1)}},P=()=>{!o||!l||w(!0)},A=async()=>{try{await y(l),d("/dashboard",{state:{message:"Proposal deleted successfully!",variant:"success"}})}catch(a){console.error("Error deleting proposal:",a),c({form:"Failed to delete proposal. Please try again."})}finally{w(!1)}};return e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(L,{to:o?`/proposals/${l}`:"/dashboard",className:"text-primary-600 hover:text-primary-800 flex items-center",state:{fromForm:!0},children:[e.jsx(R,{size:18,className:"mr-1"}),e.jsxs("span",{children:["Back to ",o?"Proposal Details":"Dashboard"]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:o?"Edit Proposal":"New Proposal"})}),e.jsxs("form",{onSubmit:D,className:"p-6",noValidate:!0,children:[r.form&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 text-red-700 rounded-md",role:"alert",children:r.form}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:u,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${r.title?"border-red-300":""}`,"aria-invalid":!!r.title,"aria-describedby":r.title?"title-error":void 0,required:!0}),r.title&&e.jsx("p",{className:"mt-2 text-sm text-red-600",id:"title-error",role:"alert",children:r.title})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"agency",className:"block text-sm font-medium text-gray-700",children:["Agency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"agency",name:"agency",value:s.agency,onChange:u,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${r.agency?"border-red-300":""}`,"aria-invalid":!!r.agency,"aria-describedby":r.agency?"agency-error":void 0,required:!0}),r.agency&&e.jsx("p",{className:"mt-2 text-sm text-red-600",id:"agency-error",role:"alert",children:r.agency})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700",children:["Due Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",id:"dueDate",name:"dueDate",value:s.dueDate,onChange:u,min:new Date().toISOString().split("T")[0],className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm ${r.dueDate?"border-red-300":""}`,"aria-invalid":!!r.dueDate,"aria-describedby":r.dueDate?"duedate-error":void 0,required:!0}),r.dueDate&&e.jsx("p",{className:"mt-2 text-sm text-red-600",id:"duedate-error",role:"alert",children:r.dueDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm","aria-label":"Select proposal status",children:[e.jsx("option",{value:"intake",children:"Intake"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"awarded",children:"Awarded"}),e.jsx("option",{value:"not_awarded",children:"Not Awarded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700",children:"Type"}),e.jsxs("select",{id:"type",name:"type",value:s.type,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm","aria-label":"Select proposal type",children:[e.jsx("option",{value:"federal",children:"Federal"}),e.jsx("option",{value:"state",children:"State"}),e.jsx("option",{value:"local",children:"Local"}),e.jsx("option",{value:"commercial",children:"Commercial"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"notes",name:"notes",rows:4,value:s.notes,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",placeholder:"Add any additional notes or details about this proposal...","aria-label":"Proposal notes"})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row justify-between gap-4",children:[e.jsx("div",{children:o&&e.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500","aria-label":"Delete proposal",children:[e.jsx(J,{size:16,className:"mr-2"}),"Delete Proposal"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{h?window.confirm("You have unsaved changes. Are you sure you want to leave?")&&d(o?`/proposals/${l}`:"/dashboard"):d(o?`/proposals/${l}`:"/dashboard")},className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(B,{size:16,className:"mr-2"}),"Cancel"]}),e.jsx("button",{type:"submit",disabled:i||!h,className:`inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white ${i?"bg-primary-400":"bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"} ${h?"":"opacity-50 cursor-not-allowed"}`,"aria-busy":i,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16,className:"mr-2"}),o?"Update":"Create"," Proposal"]})})]})]})]})]}),e.jsx(C,{isOpen:F,onConfirm:k,onCancel:()=>b(!1),title:o?"Update Proposal":"Create New Proposal",message:`Are you sure you want to ${o?"update":"create"} this proposal?`,confirmText:i?"Saving...":"Confirm",variant:"default"}),e.jsx(C,{isOpen:E,onConfirm:A,onCancel:()=>w(!1),title:"Delete Proposal",message:"Are you sure you want to delete this proposal? This action cannot be undone.",confirmText:i?"Deleting...":"Delete",variant:"danger"}),h&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-yellow-50 border-t border-yellow-200 p-4 shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 pt-0.5",children:e.jsx(S,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),e.jsx("p",{className:"ml-3 text-sm text-yellow-700",children:e.jsx("span",{children:"You have unsaved changes."})})]}),e.jsxs("div",{className:"flex-shrink-0 sm:ml-4",children:[e.jsx("button",{type:"button",onClick:()=>{m(JSON.parse(j.current)),N(!1)},className:"mr-3 text-sm font-medium text-yellow-700 hover:text-yellow-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:"Discard Changes"}),e.jsx("button",{type:"button",onClick:D,className:"px-3 py-1.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:"Save Changes"})]})]})})})]})};export{_ as default};
//# sourceMappingURL=ProposalForm.8995dc37.js.map
