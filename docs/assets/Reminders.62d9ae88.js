import{j as e,a as ve}from"./main.b5b31452.js";import{R as Ne,r as d}from"./react-vendor.36470f4f.js";import{c as le,P as t,d as we,i as Te,e as De}from"./dateUtils.a866c5f2.js";import{E as Se}from"./ErrorBoundary.68fec82e.js";import{d as re}from"./statusUtils.42174679.js";import{T as H}from"./TaskCard.0c7bc4ac.js";import{P as Y}from"./ProposalCard.37143e78.js";import{L as Ce}from"./LoadingSpinner.1e7844f4.js";import{p as Oe,R as de,x as Pe,f as ae,k as B,g as v,h as Re,X as Ie,r as ie,e as oe,O as Le}from"./ui-lib.676c71c1.js";import{t as W,c as Ee}from"./isValid.f1396d2d.js";import{i as Ae}from"./isSameDay.07bbb616.js";import{g as He,s as ne}from"./format.ad2c0b21.js";import{p as M}from"./parseISO.585b4435.js";import"./UrgencyBadge.5d6278af.js";function z(i,n){const c=W(i);return isNaN(n)?Ee(i,NaN):(n&&c.setDate(c.getDate()+n),c)}function We(i){const n=W(i);return n.setHours(23,59,59,999),n}function qe(i,n){var b,C,h,w;const c=He(),m=(n==null?void 0:n.weekStartsOn)??((C=(b=n==null?void 0:n.locale)==null?void 0:b.options)==null?void 0:C.weekStartsOn)??c.weekStartsOn??((w=(h=c.locale)==null?void 0:h.options)==null?void 0:w.weekStartsOn)??0,g=W(i),y=g.getDay(),N=(y<m?-7:0)+6-(y-m);return g.setDate(g.getDate()+N),g.setHours(23,59,59,999),g}function Q(i,n){const c=W(i),m=W(n);return c.getTime()>m.getTime()}function Fe(i,n,c){const m=ne(i,c),g=ne(n,c);return+m==+g}function Me(i,n){return Fe(i,le(i),n)}function Ye(i){return Ae(i,z(le(i),1))}function $e(i,n){return z(i,-n)}const U=()=>e.jsxs("div",{className:"animate-pulse p-4 border rounded-lg mb-2 bg-gray-50",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-100 rounded w-1/2"})]});t.string.isRequired;const f=Ne.memo(({icon:i,title:n,description:c,action:m,className:g=""})=>e.jsxs("div",{className:`text-center py-12 ${g}`,children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 dark:bg-gray-800 mb-3",children:e.jsx(i,{className:"h-6 w-6 text-gray-400","aria-hidden":"true"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:n}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:c}),m&&e.jsx("div",{className:"mt-4",children:m})]}));f.propTypes={icon:t.elementType.isRequired,title:t.string.isRequired,description:t.string.isRequired,action:t.node,className:t.string};f.defaultProps={action:null,className:""};f.displayName="EmptyState";const $=d.memo(({error:i,onRetry:n,className:c=""})=>e.jsxs("div",{className:`p-4 bg-red-50 border border-red-200 dark:bg-red-900/10 dark:border-red-900/30 rounded-md ${c}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Error loading reminders"})]}),e.jsx("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(i==null?void 0:i.message)||"An unknown error occurred"}),n&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{type:"button",onClick:n,className:"text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-600 dark:hover:text-red-200 focus:outline-none flex items-center",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Retry"]})})]}));$.propTypes={error:t.instanceOf(Error),onRetry:t.func,className:t.string};$.defaultProps={error:null,onRetry:null,className:""};$.displayName="ErrorState";const ce=d.memo(({task:i})=>e.jsx("div",{className:"mb-2",children:e.jsx(H,{task:i})}));ce.propTypes={task:t.shape({id:t.string.isRequired,title:t.string.isRequired,description:t.string,dueDate:t.oneOfType([t.string,t.instanceOf(Date)]),status:t.string,priority:t.string,completed:t.bool,completedAt:t.oneOfType([t.string,t.instanceOf(Date)])}).isRequired};ce.displayName="TaskItem";const ue=d.memo(({proposal:i})=>e.jsx("div",{className:"mb-4",children:e.jsx(Y,{proposal:i})}));ue.propTypes={proposal:t.shape({id:t.string.isRequired,title:t.string.isRequired,status:t.string,dueDate:t.oneOfType([t.string,t.instanceOf(Date)]),client:t.string,value:t.number,currency:t.string}).isRequired};ue.displayName="ProposalItem";const _=d.memo(({items:i,renderItem:n,containerHeight:c=400,emptyState:m=null,loading:g=!1,loadingComponent:y=null})=>g?y||e.jsx("div",{className:"flex justify-center items-center",style:{height:c},children:e.jsx(Pe,{className:"h-8 w-8 animate-spin text-gray-400"})}):!i||i.length===0?m||e.jsx("div",{className:"flex justify-center items-center text-gray-500",style:{height:c},children:"No items to display"}):e.jsx("div",{className:"space-y-2 pr-2 -mr-2",style:{maxHeight:c,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#9ca3af #f3f4f6"},children:i.map((N,b)=>e.jsx("div",{className:"transition-all duration-200 hover:scale-[1.01]",children:n({item:N,index:b})},N.id||b))}));_.propTypes={items:t.arrayOf(t.object).isRequired,renderItem:t.func.isRequired,containerHeight:t.oneOfType([t.number,t.string]),emptyState:t.node,loading:t.bool,loadingComponent:t.node};_.defaultProps={containerHeight:400,emptyState:null,loading:!1,loadingComponent:null};_.displayName="SimpleList";const S=_,G=()=>{const{proposals:i=[],isLoading:n,error:c}=ve(),[m,g]=d.useState("overdue"),[y,N]=d.useState(!1),[b,C]=d.useState(null),[h,w]=d.useState({status:"all",priority:"all",dueDate:"anytime",searchQuery:""}),[O,me]=d.useState({field:"dueDate",direction:"asc"}),[q,Z]=d.useState(""),[V,X]=d.useState("");d.useEffect(()=>{const r=setTimeout(()=>{X(q)},300);return()=>{clearTimeout(r)}},[q]),d.useEffect(()=>{w(r=>({...r,searchQuery:V}))},[V]);const pe=d.useCallback(r=>r.filter(a=>a.urgency==="overdue"),[]),he=d.useCallback(r=>r.filter(a=>a.timeStatus==="today"||a.timeStatus==="tomorrow"||a.timeStatus==="this_week"),[]),ge=d.useCallback(r=>r.filter(a=>a.timeStatus==="upcoming"),[]),xe=d.useCallback(r=>{if(!r||!Array.isArray(r))return[];const o=qe(new Date);return r.flatMap(l=>!l||!l.tasks?[]:l.tasks.filter(p=>p&&!p.completed).map(p=>{const x=p.dueDate||p.due_date,s=x?new Date(x):null;let u="";return s&&(we(s)?u="today":Ye(s)?u="tomorrow":Me(s)?u="this_week":Q(s,o)&&(u="upcoming")),{...p,proposalId:l.id,proposalTitle:l.title,dueDate:s,timeStatus:u,status:p.status||"pending",priority:p.priority||"medium",urgency:re(p.dueDate||x)}}))},[]),T=d.useMemo(()=>{try{return xe(i)}catch(r){return console.error("Error processing tasks:",r),C("Failed to process tasks. Please try refreshing the page."),[]}},[i]);d.useCallback(r=>{g(r)},[]);const{overdueTasks:k,tasksThisWeek:P,upcomingTasks:R,overdueProposals:j,completedTasks:I,proposalsDueSoon:L}=d.useMemo(()=>{if(!i||!T)return{overdueTasks:[],tasksThisWeek:[],upcomingTasks:[],overdueProposals:[],completedTasks:[],proposalsDueSoon:[]};try{const r=i.filter(s=>s.status!=="submitted"&&Te(s.dueDate)).sort((s,u)=>new Date(s.dueDate)-new Date(u.dueDate)),a=$e(new Date,30),o=T.filter(s=>{try{if(!s.completed||!s.completedAt)return!1;const u=M(s.completedAt);return Q(u,a)}catch(u){return console.warn("Error processing completed task:",s,u),!1}}),l=new Date,p=z(l,7),x=i.filter(s=>{try{if(!s||!s.dueDate)return!1;const u=M(s.dueDate),A=re(s.dueDate);return s.status!=="submitted"&&(A==="high"||A==="critical")&&Q(u,l)&&De(u,We(p))}catch(u){return console.warn("Error processing proposal date:",s,u),!1}}).sort((s,u)=>{try{return M(s.dueDate)-M(u.dueDate)}catch{return 0}});return{overdueTasks:pe(T),tasksThisWeek:he(T),upcomingTasks:ge(T),overdueProposals:r,completedTasks:o,proposalsDueSoon:x}}catch(r){return console.error("Error processing data:",r),C("Failed to process data."),{overdueTasks:[],tasksThisWeek:[],upcomingTasks:[],overdueProposals:[],completedTasks:[],proposalsDueSoon:[]}}finally{N(!1)}},[T,i]);if(n||y)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Ce,{text:"Loading reminders..."})});const F=d.useCallback(r=>e.jsx("div",{className:"mb-2",children:e.jsx(H,{task:r})},r.id),[]),J=d.useCallback(r=>e.jsx("div",{className:"mb-4",children:e.jsx(Y,{proposal:r})},r.id),[]);k.length>0&&(ae,Math.min(k.length*120,400)),j.length>0&&(B,Math.min(j.length*180,400)),k.length===0&&j.length===0&&v,P.length>0?Math.min(P.length*120,400):v,R.length>0?Math.min(R.length*120,400):v,L.length>0?Math.min(L.length*180,400):v,I.length>0?Math.min(I.length*120,400):v;const fe=()=>{const r=[{id:"overdue",label:"Overdue",icon:ae,count:k.length,badgeClass:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200",description:"Tasks and proposals that are past their due date"},{id:"thisWeek",label:"This Week",icon:ie,count:P.length,badgeClass:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200",description:"Tasks and proposals due this week"},{id:"upcoming",label:"Upcoming",icon:oe,count:R.length,badgeClass:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200",description:"Tasks and proposals due in the future"},{id:"proposals",label:"Proposals",icon:B,count:L.length,badgeClass:"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200",description:"Proposals with approaching deadlines"},{id:"completed",label:"Completed",icon:v,count:I.length,badgeClass:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200",description:"Recently completed tasks and proposals"}];return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("label",{htmlFor:"tabs",className:"sr-only",children:"Select a tab"}),e.jsx("select",{id:"tabs",name:"tabs",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm",value:m,onChange:a=>g(a.target.value),children:r.map(a=>e.jsxs("option",{value:a.id,children:[a.label," ",a.count>0?`(${a.count})`:""]},a.id))})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto pb-px","aria-label":"Tabs",children:r.map(a=>{const o=m===a.id,l=a.icon;return e.jsxs("button",{type:"button",onClick:()=>g(a.id),className:`
                      group inline-flex items-center border-b-2 py-4 px-1 text-sm font-medium
                      ${o?"border-blue-500 text-blue-600 dark:text-blue-400 dark:border-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600"}
                      whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900
                      transition-colors duration-150 ease-in-out relative
                    `,"aria-current":o?"page":void 0,title:a.description,children:[e.jsx(l,{className:`mr-2 h-5 w-5 ${o?"opacity-100":"opacity-70 group-hover:opacity-100"}`,"aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:a.label}),a.count>0&&e.jsx("span",{className:`ml-2 py-0.5 px-2 rounded-full text-xs font-medium ${a.badgeClass} min-w-[1.5rem] inline-flex items-center justify-center`,"aria-label":`${a.count} items`,children:a.count}),e.jsx("span",{className:"sr-only",children:a.description})]},a.id)})})})})]})},K=d.useCallback((r,a="task")=>r.filter(o=>{var l,p,x;if(h.status!=="all"&&(h.status==="completed"&&!o.completed||h.status==="active"&&o.completed||h.status==="pending"&&o.status!=="pending")||h.priority!=="all"&&o.priority!==h.priority)return!1;if(h.searchQuery){const s=h.searchQuery.trim().toLowerCase();if(!s)return!0;const A=[o.title,o.description,o.id,(l=o.assignee)==null?void 0:l.name,(p=o.owner)==null?void 0:p.name,(x=o.tags)==null?void 0:x.join(" "),o.clientName,o.projectName].some(D=>D&&String(D).toLowerCase().includes(s)),ke=o.priority&&o.priority.toLowerCase().includes(s),je=o.status&&o.status.toLowerCase().includes(s);let te=!1;try{const D=new Date(s);if(!isNaN(D)){const se=o.dueDate?new Date(o.dueDate):null;se&&(te=se.toDateString()===D.toDateString())}}catch{}if(!A&&!ke&&!je&&!te)return!1}return!0}),[h]),ee=d.useCallback(r=>[...r].sort((a,o)=>{let l=0;switch(O.field){case"dueDate":const p=a.dueDate?new Date(a.dueDate):new Date(0),x=o.dueDate?new Date(o.dueDate):new Date(0);l=p-x;break;case"priority":const s={high:3,medium:2,low:1};l=(s[a.priority]||0)-(s[o.priority]||0);break;case"title":l=(a.title||"").localeCompare(o.title||"");break;default:l=0}return O.direction==="desc"?-l:l}),[O]),E=d.useCallback(r=>{const a=K(r);return ee(a)},[K,ee]),ye=()=>({overdue:{items:E([...k,...j]),emptyState:{icon:v,title:"No overdue items",description:"You're all caught up! No overdue tasks or proposals."}},thisWeek:{items:E(P),emptyState:{icon:ie,title:"No tasks this week",description:"You don't have any tasks due this week."}},upcoming:{items:E(R),emptyState:{icon:oe,title:"No upcoming tasks",description:"You don't have any upcoming tasks scheduled."}},proposals:{items:E(L),emptyState:{icon:B,title:"No proposals due soon",description:"You don't have any proposals with upcoming deadlines."},isGrid:!0},completed:{items:E(I),emptyState:{icon:Le,title:"No completed items",description:"Your completed tasks will appear here."},showCompleted:!0}}),be=()=>{if(n)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{}),e.jsx(U,{}),e.jsx(U,{})]});const a=ye()[m]||{},{items:o=[],emptyState:l,isGrid:p=!1}=a;if(m==="overdue")return e.jsxs("div",{className:"space-y-6",children:[k.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Overdue Tasks"}),e.jsx("div",{className:"space-y-2",children:k.map(s=>e.jsx(H,{task:s},s.id))})]}),j.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Overdue Proposals"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2",children:j.map(s=>e.jsx(Y,{proposal:s},s.id))})]}),o.length===0&&e.jsx(f,{icon:l.icon,title:l.title,description:l.description})]});if(o.length===0)return e.jsx(f,{icon:l.icon,title:l.title,description:l.description});if(p)return e.jsx("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2",children:o.map(s=>m==="proposals"?e.jsx(Y,{proposal:s},s.id):e.jsx(H,{task:s},s.id))});const x=m==="completed";return e.jsx("div",{className:"space-y-2",children:o.map(s=>e.jsx(H,{task:s,showCompleted:x},s.id))})};return c||b?e.jsx("div",{className:"p-4",children:e.jsx($,{error:c||b,onRetry:()=>window.location.reload()})}):e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Reminders"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Track your upcoming tasks and deadlines"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>window.location.reload(),disabled:n||y,className:`inline-flex items-center px-3 py-2 border rounded-md shadow-sm text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 ${n||y?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 focus:ring-blue-500"}`,children:[e.jsx(de,{className:`h-4 w-4 mr-2 ${n||y?"animate-spin":""}`}),"Refresh"]})})]}),fe(),e.jsx("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Re,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",name:"search",id:"search",className:"block w-full pl-10 pr-10 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Search tasks and proposals...",value:q,onChange:r=>Z(r.target.value),"aria-label":"Search tasks and proposals"}),q?e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>{Z(""),X("")},"aria-label":"Clear search",children:e.jsx(Ie,{className:"h-4 w-4 text-gray-400 hover:text-gray-500"})}):null]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"sr-only",children:"Status"}),e.jsxs("select",{id:"status-filter",className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:h.status,onChange:r=>w({...h,status:r.target.value}),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority-filter",className:"sr-only",children:"Priority"}),e.jsxs("select",{id:"priority-filter",className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:h.priority,onChange:r=>w({...h,priority:r.target.value}),children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"sr-only",children:"Sort by"}),e.jsxs("select",{id:"sort-by",className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",value:`${O.field}-${O.direction}`,onChange:r=>{const[a,o]=r.target.value.split("-");me({field:a,direction:o})},children:[e.jsx("option",{value:"dueDate-asc",children:"Due Date: Earliest First"}),e.jsx("option",{value:"dueDate-desc",children:"Due Date: Latest First"}),e.jsx("option",{value:"priority-desc",children:"Priority: High to Low"}),e.jsx("option",{value:"priority-asc",children:"Priority: Low to High"}),e.jsx("option",{value:"title-asc",children:"Title: A to Z"}),e.jsx("option",{value:"title-desc",children:"Title: Z to A"})]})]})]})]})}),e.jsx(Se,{children:be()})]})})};G.propTypes={proposals:t.arrayOf(t.shape({id:t.string.isRequired,title:t.string.isRequired,status:t.string,dueDate:t.oneOfType([t.string,t.instanceOf(Date)]),client:t.string,value:t.number,currency:t.string})),isLoading:t.bool,error:t.instanceOf(Error),initialActiveTab:t.string,initialIsProcessing:t.bool};G.defaultProps={proposals:[],isLoading:!1,error:null,initialActiveTab:"overdue",initialIsProcessing:!1};const _e=d.memo(G);_e.displayName="MemoizedReminders";export{_e as default};
//# sourceMappingURL=Reminders.62d9ae88.js.map
