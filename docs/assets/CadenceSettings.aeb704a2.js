import{j as e}from"./main.f7b3b261.js";import{r,a as R}from"./react-vendor.36470f4f.js";import{B as g}from"./react-toastify.esm.4d70bec4.js";import{b as H,g as k,s as $}from"./api.99838237.js";import{Z as q,e as W,f as Y}from"./ui-lib.676c71c1.js";const B=({isOpen:o,onConfirm:l,onCancel:i,title:m,message:n,confirmText:f="Confirm",cancelText:c="Cancel"})=>{if(!o)return null;const h=r.useRef(null);return r.useEffect(()=>{const d=x=>{x.key==="Escape"&&i(),x.key==="Enter"&&x.ctrlKey&&l()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[l,i]),r.useEffect(()=>{if(o&&h.current){const d=h.current.querySelectorAll("button");d.length>0&&d[0].focus()}},[o]),R.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",children:e.jsxs("div",{ref:h,className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",onKeyDown:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:h-10 sm:w-10",children:e.jsx(Y,{className:"h-6 w-6 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{id:"dialog-title",className:"text-lg font-medium text-gray-900",children:m}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:n})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense",children:[e.jsx("button",{type:"button",onClick:l,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm",autoFocus:!0,children:f}),e.jsx("button",{type:"button",onClick:i,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:col-start-1 sm:text-sm",children:c})]})]})}),document.body)},w=["MON","TUE","WED","THU","FRI","SAT","SUN"],b=[{value:"America/New_York",label:"Eastern Time (US & Canada)"},{value:"America/Chicago",label:"Central Time (US & Canada)"},{value:"America/Denver",label:"Mountain Time (US & Canada)"},{value:"America/Los_Angeles",label:"Pacific Time (US & Canada)"},{value:"America/Phoenix",label:"Arizona"},{value:"America/Anchorage",label:"Alaska"},{value:"America/Adak",label:"Hawaii-Aleutian"},{value:"Pacific/Honolulu",label:"Hawaii"}],z=o=>{const l=-o.getTimezoneOffset(),i=Math.floor(Math.abs(l)/60),m=Math.abs(l)%60;return`UTC${l>=0?"+":"-"}${String(i).padStart(2,"0")}:${String(m).padStart(2,"0")}`},V=o=>{var l;try{const i=b.find(c=>c.value===o);if(i)return i.label;const m=new Date,n={timeZone:o,timeZoneName:"long",timeStyle:"long",hour12:!1};return((l=new Intl.DateTimeFormat("en-US",n).formatToParts(m).find(c=>c.type==="timeZoneName"))==null?void 0:l.value)||o}catch{return o}};function te(){const[o,l]=r.useState(["MON","WED"]),[i,m]=r.useState("09:00"),[n,f]=r.useState(()=>Intl.DateTimeFormat().resolvedOptions().timeZone),[c,h]=r.useState(""),[d,x]=r.useState(!0),[y,j]=r.useState(!1),[N,S]=r.useState(null),[C,E]=r.useState(new Date),[A,v]=r.useState(!1),[D,F]=r.useState(null),I=r.useRef(null),p=r.useRef(null);r.useEffect(()=>{const t=setInterval(()=>E(new Date),1e3);return()=>clearInterval(t)},[]);const P=r.useMemo(()=>{try{return new Intl.DateTimeFormat("en-US",{timeZone:n,hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(C)}catch{return"Invalid timezone"}},[n,C]),T=r.useMemo(()=>{try{const t=new Date,s=new Date(t.toLocaleString("en-US",{timeZone:n}));return z(s)}catch{return""}},[n]);r.useEffect(()=>{(async()=>{var s;x(!0);try{const[a,u]=await Promise.all([H().catch(()=>({})),k().catch(()=>({}))]);a.days&&l(a.days),a.time&&m(a.time),a.tz&&(f(a.tz),b.includes(a.tz)||h(a.tz)),(s=u==null?void 0:u.last_processed)!=null&&s.timestamp&&S(new Date(u.last_processed.timestamp))}catch(a){console.error("Failed to load settings:",a),g.error("Failed to load settings. Please refresh the page.")}finally{x(!1)}})()},[]);const U=t=>{l(s=>s.includes(t)?s.filter(u=>u!==t):[...s,t].sort((u,K)=>w.indexOf(u)-w.indexOf(K)))},L=t=>{const s=t.target.value;s==="custom"?f(c||Intl.DateTimeFormat().resolvedOptions().timeZone):(f(s),h(""))},M=t=>{const s=t.target.value;h(s),s&&f(s)},Z=()=>o.length===0?(g.error("Please select at least one day"),!1):i?n?!0:(g.error("Please select a timezone"),!1):(g.error("Please select a time"),!1),_=async t=>{if(t.preventDefault(),!Z())return;const s={days:o,time:i.padStart(5,"0"),tz:n};F(s),p.current=document.activeElement,v(!0)},O=async()=>{var t;if(D){v(!1),j(!0);try{const s=await $(D);if(s!=null&&s.success){g.success(s.rebuilt?"Cadence applied & triggers rebuilt successfully!":"Cadence settings saved successfully!");try{const a=await k();(t=a==null?void 0:a.last_processed)!=null&&t.timestamp&&S(new Date(a.last_processed.timestamp))}catch(a){console.warn("Could not refresh health status:",a)}}else throw new Error((s==null?void 0:s.error)||"Failed to save cadence settings")}catch(s){console.error("Save failed:",s),g.error(`Error: ${s.message||"Failed to save settings"}`)}finally{j(!1),p.current&&p.current.focus()}}};return d?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900"})}):e.jsxs("div",{className:"max-w-2xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cadence Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure when and how often the system should process proposals."})]}),e.jsxs("form",{ref:I,onSubmit:_,className:"space-y-6",onKeyDown:handleFormKeyDown,"aria-label":"Cadence settings form",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Processing Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",role:"group","aria-label":"Select processing days",children:w.map(t=>{const s=o.includes(t);return e.jsx("button",{id:`day-${t}`,type:"button",onClick:()=>U(t),onKeyDown:a=>handleDayKeyDown(t,a),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${s?"bg-blue-600 text-white hover:bg-blue-700":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,role:"checkbox","aria-checked":s,tabIndex:0,children:t},t)})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Select days when the system should process proposals"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700 mb-2",children:"Processing Time (24h)"}),e.jsx("input",{id:"time",type:"time",value:i,onChange:t=>m(t.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200 sm:text-sm p-2 border",required:!0,"aria-required":"true","aria-describedby":"time-help"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Time of day to process proposals"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"timezone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Timezone"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"timezone",value:b.some(t=>t.value===n)?n:"custom",onChange:L,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200 sm:text-sm p-2 border","aria-describedby":"timezone-help",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a timezone"}),b.map(t=>e.jsxs("option",{value:t.value,children:[t.label," (",z(new Date(new Date().toLocaleString("en-US",{timeZone:t.value}))),")"]},t.value)),e.jsx("option",{value:"custom",children:"Custom timezone..."})]}),(!b.some(t=>t.value===n)||c)&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:M,placeholder:"Enter IANA timezone (e.g., America/New_York)",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200 sm:text-sm p-2 border pr-10","aria-describedby":"timezone-help"}),n&&!b.some(t=>t.value===n)&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm",children:T})})]}),n&&e.jsxs("div",{className:"mt-1 flex items-center text-xs text-gray-500",children:[e.jsx(q,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{children:V(n)})]})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-600",children:[e.jsx(W,{className:"w-4 h-4 mr-1.5 text-gray-500 flex-shrink-0"}),e.jsxs("span",{children:["Current time: ",P," ",T]})]}),e.jsx("p",{id:"timezone-help",className:"mt-1 text-xs text-gray-500",children:"Selected timezone will be used for all scheduled processing"})]})]}),N&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Last processed: ",N.toLocaleString()]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>window.location.reload(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y,"aria-label":"Cancel changes and reload page",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-busy":y,"aria-live":"polite",children:y?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Saving..."})]}):e.jsxs("span",{children:["Save Settings ",e.jsx("span",{className:"text-xs opacity-70",children:"(Ctrl+Enter)"})]})})]})]})]}),e.jsx(B,{isOpen:A,onConfirm:O,onCancel:()=>{v(!1),p.current&&p.current.focus()},title:"Confirm Schedule Change",message:"Are you sure you want to update the processing schedule? This will affect when the system processes proposals.",confirmText:"Update Schedule"})]})}export{te as default};
//# sourceMappingURL=CadenceSettings.aeb704a2.js.map
